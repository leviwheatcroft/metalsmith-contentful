<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "lib/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h2">
        <a href="#overview">overview</a>
      </div>

      <div class="heading h3">
        <a href="#plugin">plugin</a>
      </div>

      <div class="heading h2">
        <a href="#constructor-1">constructor</a>
      </div>

      <div class="heading h2">
        <a href="#contentful">contentful</a>
      </div>

      <div class="heading h2">
        <a href="#scrape">scrape</a>
      </div>

      <div class="heading h2">
        <a href="#retrieve">retrieve</a>
      </div>

      <div class="heading h2">
        <a href="#fetch">fetch</a>
      </div>

      <div class="heading h2">
        <a href="#applymeta">applyMeta</a>
      </div>

      <div class="heading h2">
        <a href="#makefiles">makeFiles</a>
      </div>

      <div class="heading h2">
        <a href="#coerce">coerce</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="overview">
  <h2>
    <a href="#overview" name="overview" class="pilcrow"></a>
overview
  </h2>
</div>
<ul>
<li>scrape <em>everything</em> from space (no queries / filters)</li>
<li>store space in cache</li>
<li>expose everything from cache in metadata <code>contentful</code> property, along
with <code>find</code> and <code>findOne</code></li>
<li>add files to metalsmith <code>files</code> structure according to query</li>
</ul>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">import</span> debug <span class="hljs-keyword">from</span> <span class="hljs-string">'debug'</span>
<span class="hljs-keyword">import</span> vow <span class="hljs-keyword">from</span> <span class="hljs-string">'vow'</span>
<span class="hljs-keyword">import</span> {
  createClient <span class="hljs-keyword">as</span> flashheart
} <span class="hljs-keyword">from</span> <span class="hljs-string">'flashheart'</span>
<span class="hljs-keyword">import</span> promiseSpool <span class="hljs-keyword">from</span> <span class="hljs-string">'promise-spool'</span>
<span class="hljs-keyword">import</span> {
  join
} <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">import</span> slugify <span class="hljs-keyword">from</span> <span class="hljs-string">'slugify'</span>
<span class="hljs-keyword">import</span> Cache <span class="hljs-keyword">from</span> <span class="hljs-string">'./Cache'</span>
<span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">'moment'</span>

<span class="hljs-keyword">const</span> dbg = debug(<span class="hljs-string">'metalsmith-contentful'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="plugin">
  <h3>
    <a href="#plugin" name="plugin" class="pilcrow"></a>
plugin
  </h3>
</div>
<p>wrapper to expose plugin</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opt</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opt.space</span>
<span class="dox_type">String</span>
<span>(reqd) contentful space id
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opt.accessToken</span>
<span class="dox_type">String</span>
<span>(reqd) contentful access token
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opt.resolveDepth</span>
<span class="dox_type">Number</span>
<span>(default: 2) recursion for resolving links
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opt.concurrency</span>
<span class="dox_type">Number</span>
<span>(default: 3) concurrent cache ops (memory rw)
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opt.files</span>
<span class="dox_type">Object</span>
<span>(default: {}) file creation opts
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opt.files.destPath</span>
<span class="dox_type">String</span>
<span>(reqd) path under which to place files
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opt.files.coerce</span>
<span class="dox_type">Function</span>
<span>(default: (file) =&gt; file) see Space.coerce
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options.files.query</span>
<span class="dox_type">String</span>
<span class="dox_type">Object</span>
<span>(reqd) files to create
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">plugin</span> (<span class="hljs-params">opt</span>) </span>{
  <span class="hljs-keyword">const</span> folder = <span class="hljs-keyword">new</span> Space(opt)
  <span class="hljs-keyword">return</span> folder.contentful.bind(folder)
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Space</span> </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="constructor-1">
  <h2>
    <a href="#constructor-1" name="constructor-1" class="pilcrow"></a>
constructor
  </h2>
</div>
<p>see params for <code>plugin</code></p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">constructor</span> (opt) {
    <span class="hljs-keyword">let</span> err
    <span class="hljs-keyword">if</span> (!opt) err = <span class="hljs-string">'no options passed'</span>
    <span class="hljs-keyword">if</span> (!opt.space) err = <span class="hljs-string">'required option: space'</span>
    <span class="hljs-keyword">if</span> (!opt.accessToken) err = <span class="hljs-string">'required option: opt.accessToken'</span>
    <span class="hljs-keyword">if</span> (!opt.resolveDepth) opt.resolveDepth = <span class="hljs-number">2</span>
    <span class="hljs-keyword">if</span> (!opt.concurrency) opt.concurrency = <span class="hljs-number">3</span>
    <span class="hljs-keyword">if</span> (opt.files) {
      <span class="hljs-keyword">if</span> (!opt.files.coerce) opt.files.coerce = <span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> file
      <span class="hljs-keyword">if</span> (!opt.files.destPath) err = <span class="hljs-string">'required option: files.destPath'</span>
      <span class="hljs-keyword">if</span> (!opt.files.query) err = <span class="hljs-string">'required option: files.query'</span>
    }
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err)
    <span class="hljs-keyword">this</span>.opt = opt
    <span class="hljs-keyword">this</span>.cache = <span class="hljs-keyword">new</span> Cache(<span class="hljs-keyword">this</span>.opt)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>initialise contentful client</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.client = flashheart({
      <span class="hljs-attr">defaults</span>: {<span class="hljs-attr">qs</span>: {<span class="hljs-attr">access_token</span>: opt.accessToken}}
    })
  }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="contentful">
  <h2>
    <a href="#contentful" name="contentful" class="pilcrow"></a>
contentful
  </h2>
</div>
<p>this is the plugin function exposed to metalsmith</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">files</span>
<span class="dox_type">Object</span>
<span>metalsmith files structure
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">metalsmith</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Promise</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  contentful (files, metalsmith) {
    <span class="hljs-keyword">this</span>.files = files
    <span class="hljs-keyword">this</span>.metalsmith = metalsmith
    <span class="hljs-keyword">return</span> vow.resolve()
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.cache.invalidate())
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.scrape())
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.applyMeta())
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.makeFiles())
    .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      dbg(err)
    })
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="scrape">
  <h2>
    <a href="#scrape" name="scrape" class="pilcrow"></a>
scrape
  </h2>
</div>
<p>oversees operation of scraping entire space to cache
by design, there's no options to limit what get's pulled down</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Promise</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  scrape () {
    <span class="hljs-keyword">return</span> vow.resolve()
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.cache.requestOrCache())
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.retrieve(<span class="hljs-string">'content_types'</span>))
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.retrieve(<span class="hljs-string">'entries'</span>))
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.retrieve(<span class="hljs-string">'assets'</span>))
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.cache.resolveContentTypes())
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-keyword">this</span>.cache.count()
      .then(<span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> dbg(<span class="hljs-string">`retrieved <span class="hljs-subst">${count}</span> items`</span>))
    })
    .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err.message === <span class="hljs-string">'cache only'</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-keyword">throw</span> err
    })
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="retrieve">
  <h2>
    <a href="#retrieve" name="retrieve" class="pilcrow"></a>
retrieve
  </h2>
</div>
<p>async structure to drain everything from an endpoint with consecutive
requests if required. Should play nice with large spaces.
contentful api is fairly consistent so this works with all relevant
endpoints</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">endpoint</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Promise</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  retrieve (endpoint) {
    <span class="hljs-keyword">return</span> promiseSpool({
      <span class="hljs-attr">fetch</span>: <span class="hljs-function">(<span class="hljs-params">retrieved</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> url = <span class="hljs-string">`/spaces/<span class="hljs-subst">${<span class="hljs-keyword">this</span>.opt.space}</span>/<span class="hljs-subst">${endpoint}</span>`</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fetch(url, {<span class="hljs-attr">qs</span>: {<span class="hljs-attr">skip</span>: retrieved}})
        .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (retrieved + res.items.length &gt;= res.total) res.items.push(<span class="hljs-literal">null</span>)
          <span class="hljs-keyword">return</span> res.items
        })
      },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>each item returned is simply added to cache</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      worker: <span class="hljs-keyword">this</span>.cache.upsert.bind(<span class="hljs-keyword">this</span>.cache),
      <span class="hljs-attr">concurrency</span>: <span class="hljs-keyword">this</span>.concurrency
    })
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="fetch">
  <h2>
    <a href="#fetch" name="fetch" class="pilcrow"></a>
fetch
  </h2>
</div>
<p>manage a single request from contentful</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">url</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">query</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Promise.&lt;Response&gt;</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  fetch (url, query) {
    <span class="hljs-keyword">let</span> defer = vow.defer()
    <span class="hljs-keyword">this</span>.client.get(
      <span class="hljs-string">`https://cdn.contentful.com/<span class="hljs-subst">${url}</span>`</span>,
      query,
      (err, res) =&gt; {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> defer.reject(err)
        defer.resolve(res)
      }
    )
    <span class="hljs-keyword">return</span> defer.promise()
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="applymeta">
  <h2>
    <a href="#applymeta" name="applymeta" class="pilcrow"></a>
applyMeta
  </h2>
</div>
<p>this gets everything from the cache, resolves it, and adds it to
metalsmith meta in an object keyed by contentful id</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Promise</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  applyMeta () {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cache.find({}, <span class="hljs-keyword">this</span>.opt.resolveDepth)
    .then(<span class="hljs-function">(<span class="hljs-params">docs</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> entries = {
        <span class="hljs-attr">find</span>: <span class="hljs-keyword">this</span>.cache.find.bind(<span class="hljs-keyword">this</span>.cache),
        <span class="hljs-attr">findOne</span>: <span class="hljs-keyword">this</span>.cache.findOne.bind(<span class="hljs-keyword">this</span>.cache)
      }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>key meta by id, omit <code>sys</code></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      docs.forEach(<span class="hljs-function">(<span class="hljs-params">doc</span>) =&gt;</span> { entries[doc.sys.id] = doc.fields })
      <span class="hljs-keyword">this</span>.metalsmith.metadata().contentful = entries
      dbg(<span class="hljs-string">`added <span class="hljs-subst">${<span class="hljs-built_in">Object</span>.keys(entries).length - <span class="hljs-number">2</span>}</span> items to meta`</span>)
    })
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="makefiles">
  <h2>
    <a href="#makefiles" name="makefiles" class="pilcrow"></a>
makeFiles
  </h2>
</div>
<p>query entries and construct metalsmith files from them</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Promise</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  makeFiles () {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.opt.files) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">let</span> query = <span class="hljs-keyword">this</span>.opt.files.query
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>for convenience, you can just pass a contentType instead of a query</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> query === <span class="hljs-string">'string'</span>) query = {<span class="hljs-string">'sys.contentType.name'</span>: query}
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cache.find(query, <span class="hljs-keyword">this</span>.opt.resolveDepth)
    .then(<span class="hljs-function">(<span class="hljs-params">docs</span>) =&gt;</span> {
      docs.forEach(<span class="hljs-function">(<span class="hljs-params">doc</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> file = <span class="hljs-keyword">this</span>.coerce(doc.fields)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>attach to metalsmith files structure</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.files[file.path] = file
      })
      dbg(<span class="hljs-string">`created <span class="hljs-subst">${docs.length}</span> files`</span>)
    })
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="coerce">
  <h2>
    <a href="#coerce" name="coerce" class="pilcrow"></a>
coerce
  </h2>
</div>
<p>translate entry from contentful to something more metalsmith</p>
<ul>
<li>also where we magle a path</li>
<li>applies passed in coerce fn too</li>
</ul>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">file</span>
<span class="dox_type">Object</span>
<span><ul>
<li>entry from contentful</li>
</ul>
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
<span>metalsmith file
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  coerce (file) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>the contentful example spaces use <code>body</code> for <code>content</code></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!file.contents &amp;&amp; file.body) file.content = file.body
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>many plugins expect <code>contents</code> to be a <code>Buffer</code></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (file.contents) file.contents = Buffer.from(file.contents)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>convert all ISO_8601 strings to moments &lt;-- handy!!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-built_in">Object</span>.keys(file).forEach(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> file[key] !== <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-keyword">let</span> date = moment(file[key], moment.ISO_8601, <span class="hljs-literal">true</span>)
      <span class="hljs-keyword">if</span> (!date.isValid()) <span class="hljs-keyword">return</span>
      file[key] = date
    })
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>slug-to-the-fi, preseciptive, but consumers can easily over write</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    file.slug = slugify(file.title, {<span class="hljs-attr">lower</span>: <span class="hljs-literal">true</span>})
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>mangle path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    file.path = join(<span class="hljs-keyword">this</span>.opt.files.destPath, file.slug)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>apply passed in fn</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    file = <span class="hljs-keyword">this</span>.opt.files.coerce(file)
    <span class="hljs-keyword">return</span> file
  }

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> plugin
<span class="hljs-keyword">export</span> {
  plugin
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
